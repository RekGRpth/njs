
# Copyright (C) Igor Sysoev
# Copyright (C) NGINX, Inc.

njs_found=no
NJS_HAVE_PCRE2=NO

if [ $NJS_TRY_PCRE2 = YES ]; then
    if /bin/sh -c "(pcre2-config --version)" >> $NJS_AUTOCONF_ERR 2>&1; then

        NJS_PCRE_CFLAGS=`pcre2-config --cflags`
        NJS_PCRE_LIB=`pcre2-config --libs8`

        njs_feature="PCRE2 library"
        njs_feature_name=NJS_HAVE_PCRE2
        njs_feature_run=no
        njs_feature_incs="-DPCRE2_CODE_UNIT_WIDTH=8 $NJS_PCRE_CFLAGS"
        njs_feature_libs=$NJS_PCRE_LIB
        njs_feature_test="#include <pcre2.h>

                          int main(void) {
                              pcre2_code  *re;

                              re = pcre2_compile((PCRE2_SPTR)\"\",
                                                 PCRE2_ZERO_TERMINATED, 0,
                                                 NULL, NULL, NULL);
                              return (re == NULL);
                          }"

        . auto/feature

        if [ $njs_found = yes ]; then
            NJS_HAVE_PCRE2=YES
            echo " + PCRE2 version: `pcre2-config --version`"
        fi
    fi
fi

if [ $njs_found = no ]; then
    if /bin/sh -c "(pcre-config --version)" >> $NJS_AUTOCONF_ERR 2>&1; then

        NJS_PCRE_CFLAGS=`pcre-config --cflags`
        NJS_PCRE_LIB=`pcre-config --libs`

        njs_feature="PCRE library"
        njs_feature_name=NJS_HAVE_PCRE
        njs_feature_run=no
        njs_feature_incs=$NJS_PCRE_CFLAGS
        njs_feature_libs=$NJS_PCRE_LIB
        njs_feature_test="#include <pcre.h>

                         int main(void) {
                             pcre  *re;

                             re = pcre_compile(NULL, 0, NULL, 0, NULL);
                             if (re == NULL)
                                 return 1;
                             return 0;
                         }"
        . auto/feature

        if [ $njs_found = yes ]; then
            echo " + PCRE version: `pcre-config --version`"
        fi
    fi
fi

if [ $njs_found = no ]; then
    echo
    echo $0: error: no PCRE library found.
    echo
    exit 1;
fi
